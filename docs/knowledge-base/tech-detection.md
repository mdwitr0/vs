# Детектор технологий пиратских видео-сайтов

## Обзор

Документ описывает паттерны детекции CMS и технологий для пиратских видео-сайтов.

---

## 1. DataLife Engine (DLE)

**Самая популярная CMS на пиратских сайтах СНГ.**

### HTML-маркеры

```
// JavaScript переменные (высокая точность)
var dle_root = '/'
var dle_admin = ''
var dle_login_hash = '...'
var dle_group = 5
var dle_skin = 'theme-name'

// Пути к скриптам
/engine/classes/js/dle_js.js
/engine/ajax/controller.php
/engine/modules/antibot/antibot.php
/engine/classes/highslide/

// HTML элементы
#dle-comments-form
#dle-content

// Комментарий
<!--DLE by Starter-->
```

### Meta-теги

```html
<meta name="generator" content="DataLife Engine" />
```

### HTTP Headers

```
Set-Cookie: dle_user_id=...
Set-Cookie: dle_password=...
```

### URL паттерны

```
/index.php?newsid=XXX
/YYYY/MM/DD/slug.html
/category/slug.html
/tags/tag-name/
/page/N/
/?do=search&subaction=search&story=QUERY
```

### Sitemap

- Обычно есть `/sitemap.xml`
- Стандартный XML формат

### Особенности

- **Рендеринг:** SSR (не требует headless browser)
- **Поиск:** `/?do=search&subaction=search&story=QUERY`
- **Пагинация:** `/page/N/`

### Примеры сайтов

| Домен | Skin | Особенности |
|-------|------|-------------|
| zona-films.video | kino-2023 | Стандартный DLE |
| zona-novinki.bar | novinki-smotret | antibot капча |
| kino-lordfilm2.org | kino | Поддомен на каждый фильм |

---

## 2. WordPress

### HTML-маркеры

```html
<!-- Generator -->
<meta name="generator" content="WordPress X.X.X" />

<!-- Пути -->
/wp-content/
/wp-includes/js/
/wp-admin/admin-ajax.php

<!-- CSS классы -->
.wp-block-*
.has-*-color
.has-*-background-color
.entry-content
```

### HTTP Headers

```
Link: <...>; rel="https://api.w.org/"
X-Powered-By: PHP
```

### URL паттерны

```
/YYYY/MM/slug/          (permalinks)
/?p=XXX                  (fallback)
/category/name/
/tag/name/
/wp-json/wp/v2/posts    (REST API)
```

### Sitemap

```
/sitemap.xml            (Yoast SEO)
/sitemap_index.xml      (Yoast index)
/wp-sitemap.xml         (встроенный WP 5.5+)
```

### Плагины для детекции

- **Yoast SEO:** `<!-- XML Sitemap generated by Yoast SEO -->`
- **FlatPM:** `flatpm-wp` в классах

### Особенности

- **Рендеринг:** SSR
- **REST API:** можно использовать для получения контента
- **Поиск:** `/?s=QUERY`

### Примеры сайтов

| Домен | Особенности |
|-------|-------------|
| hatiko-lordfillm.ru | WordPress + kinobalancer player |

---

## 3. CinemaPress

**Node.js CMS для автоматических онлайн-кинотеатров.**

### HTTP Headers (главный маркер!)

```
X-Powered-By: CinemaPress
```

### JavaScript маркеры

```javascript
// Глобальные переменные
CP_VER = '...'
CP_CONFIG_MD5 = '...'
CP_MODULES_MD5 = '...'

// Player
data-cinemaplayer-query-api-id
cinemaplayer
```

### URL паттерны

```
/movie/cp[ID]           (фильмы)
/tv/cp[ID]              (сериалы)
/mobile-version/        (мобильная версия)
/tv-version/            (ТВ версия)
/api/                   (API endpoints)
/ping                   (возвращает 'pong')
```

### Особенности

- **Рендеринг:** SSR (EJS templates)
- **База:** NodeJS + Sphinx + Memcached
- **Темы:** themes/ директория с Game of Thrones именами (Hodor, Sansa, etc)

### Video API интеграции

CinemaPress использует внешние API для видео:
- Bazon: `bazon.cc/api/search`
- VideoCDN: `videocdn.tv/api/short`
- Kodik: `kodikapi.com/search`
- Collaps: `api.bhcesh.me/list`
- Alloha: `api.alloha.tv`

---

## 4. uCoz

### HTML-маркеры

```javascript
// JavaScript объект
window.uCoz = {
  "language": "ru",
  "site": {
    "domain": "example.ru",
    "id": "...",
    "host": "example.ucoz.ru"
  }
}

// Функции
_uPostForm
_uWnd
_uAjaxRequest
```

### URL паттерны

```
/news/YYYY-MM-DD-XXX
/load/category/XXX
/publ/XXX
/index/XXX
```

### Cookies

```
_main_session (uCoz session)
```

### Капча

- Своя image-based капча: `/secure/?k=...&m=addcom`

### Примеры сайтов

| Домен | Особенности |
|-------|-------------|
| pravfilms.ru | uCoz хостинг (ucoz.ru поддомен) |

---

## 5. Кастомные решения

### Laravel/Livewire

```html
<!-- Livewire маркеры -->
Livewire.find('...')
[wire:loading]
[wire:cloak]
```

### Next.js (React SSR)

```javascript
// JSON в HTML
"__N_SSP": true
"buildId": "..."
"gssp": true
"page": "/film/[id]"
```

### Кастомные PHP

- Отсутствие характерных маркеров CMS
- Service Worker: `/sw.js` или `/anwap_sw.js`
- Специфичные пути: `/?r=Main/`

### Примеры сайтов

| Домен | Технология | Особенности |
|-------|------------|-------------|
| w140.zona.plus | Custom | zona.plus платформа |
| mi.anwap.today | Custom PHP | Service Worker, SSR |
| www-zagonkas.top | Laravel/Livewire | Livewire components |
| kinomore.netlify.app | Next.js | React SSR на Netlify |
| my-hit.net | Custom | Frame-busting код |

---

## 6. Детекция SSR vs CSR (SPA)

### Признаки CSR (требует headless browser)

```html
<!-- Пустые контейнеры -->
<div id="root"></div>
<div id="app"></div>

<!-- SPA маркеры -->
__NUXT__
_next/static
window.__INITIAL_STATE__
window.__PRELOADED_STATE__
```

### Эвристика

```go
func needsHeadlessBrowser(html string, contentLength int64) bool {
    // 1. Мало текстового контента (<500 символов)
    // 2. Много JS (>50KB)
    // 3. Есть SPA-маркеры

    textContent := extractTextContent(html)

    if len(textContent) < 500 && contentLength > 50000 {
        return true
    }

    spaMarkers := []string{
        `<div id="root"></div>`,
        `<div id="app"></div>`,
        `__NUXT__`,
        `_next/static`,
    }

    for _, marker := range spaMarkers {
        if strings.Contains(html, marker) {
            return true
        }
    }

    return false
}
```

---

## 7. Детекция капчи

### reCAPTCHA

```html
<script src="google.com/recaptcha/api.js">
<div class="g-recaptcha" data-sitekey="...">
```

### hCaptcha

```html
<script src="hcaptcha.com/1/api.js">
<div class="h-captcha">
```

### Cloudflare

```html
<!-- HTML -->
<div id="cf-browser-verification">
"Checking your browser"

<!-- Cookies -->
__cf_bm
cf_clearance
```

### DDoS-Guard

```
<!-- Cookies -->
__ddg1
__ddg2

<!-- Scripts -->
ddos-guard.net
```

### DLE Antibot

```
/engine/modules/antibot/antibot.php
<img src="/engine/modules/antibot/antibot.php?...">
```

### uCoz Captcha

```
/secure/?k=...&m=addcom
```

---

## 8. Детекция Sitemap

### Стандартные пути

```
/sitemap.xml
/sitemap_index.xml
/wp-sitemap.xml
/sitemap/sitemap.xml
/robots.txt (может содержать путь к sitemap)
```

### Форматы

1. **Простой XML Sitemap:**
```xml
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  <url>
    <loc>https://example.com/page</loc>
    <lastmod>2025-01-01</lastmod>
    <priority>0.7</priority>
  </url>
</urlset>
```

2. **Sitemap Index:**
```xml
<sitemapindex xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  <sitemap>
    <loc>https://example.com/sitemap-posts.xml</loc>
  </sitemap>
</sitemapindex>
```

---

## 9. Особые паттерны

### Поддомен на каждый фильм

```
hatiko-samyj-vernyj-drug-2009.kino-lordfilm2.org
```

**Признаки:**
- Поддомен содержит название фильма (slug)
- Основной домен — платформа
- Обычно DLE с особой конфигурацией

**Как работать:**
- Извлечь основной домен
- Помечать как `subdomain_per_movie: true`
- Сканировать через главный домен или wildcard DNS

### Редиректы

**Типы:**
1. HTTP 301/302 на другой домен
2. JavaScript redirect: `window.location = ...`
3. Meta refresh: `<meta http-equiv="refresh" content="0;url=...">`
4. Platform migration notice

**Пример:** zona.plus → zona.im

---

## 10. Приоритет детекции

```go
// Порядок проверок от высокого к низкому приоритету

1. HTTP Headers
   - X-Powered-By: CinemaPress  → CinemaPress
   - Link: rel="https://api.w.org/" → WordPress

2. Meta Generator
   - DataLife Engine → DLE
   - WordPress → WordPress

3. JavaScript переменные
   - var dle_root → DLE
   - window.uCoz → uCoz
   - CP_VER → CinemaPress

4. URL паттерны / Пути
   - /wp-content/ → WordPress
   - /engine/classes/ → DLE
   - /mobile-version/ → CinemaPress

5. Эвристика контента
   - Мало HTML + много JS → SPA (требует browser)
```

---

## 11. Структура результата детекции

```go
type TechDetectionResult struct {
    // CMS
    CMS           string   // DLE, WordPress, CinemaPress, uCoz, Custom, Unknown
    CMSVersion    string   // если удалось определить

    // Рендеринг
    RenderType    string   // SSR, CSR, Hybrid
    NeedsBrowser  bool     // требуется headless browser

    // SPA Framework (если CSR)
    Framework     string   // React, Vue, Next.js, Nuxt, None

    // Sitemap
    HasSitemap    bool
    SitemapURLs   []string

    // Защита
    CaptchaType   string   // none, recaptcha, hcaptcha, cloudflare, ddos-guard, dle-antibot

    // Особенности
    SubdomainPerMovie bool  // поддомен на каждый фильм

    // Метаданные
    Confidence    float64  // 0.0-1.0
    DetectedBy    []string // какие маркеры сработали
}
```

---

## 12. Тестовые сайты

| # | Домен | CMS | Render | Sitemap | Captcha | Особенности |
|---|-------|-----|--------|---------|---------|-------------|
| 1 | hatiko-lordfillm.ru | WordPress | SSR | Yoast | - | kinobalancer player |
| 2 | w140.zona.plus | Custom | SSR | - | - | zona.plus платформа |
| 3 | zona-films.video | DLE | SSR | + | - | skin: kino-2023 |
| 4 | zona-novinki.bar | DLE | SSR | + | DLE antibot | skin: novinki-smotret |
| 5 | kino-lordfilm2.org | DLE | SSR | ? | - | Поддомен/фильм |
| 6 | mi.anwap.today | Custom | SSR | - | - | Service Worker |
| 7 | w1.kinoroom.top | ? | ? | ? | ? | 404 |
| 8 | www-zagonkas.top | Laravel | SSR | - | - | Livewire |
| 9 | kinomore.netlify.app | Next.js | SSR | - | - | React SSR |
| 10 | my-hit.net | Custom | SSR | - | - | Frame-busting |
| 11 | pravfilms.ru | uCoz | SSR | - | uCoz captcha | ucoz.ru хостинг |
