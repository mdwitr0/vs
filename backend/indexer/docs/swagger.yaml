definitions:
  github_com_video-analitics_backend_pkg_status.CrawlStrategy:
    description: Crawling strategy
    enum:
    - sitemap
    type: string
    x-enum-varnames:
    - CrawlStrategySitemap
  github_com_video-analitics_backend_pkg_status.ScannerType:
    description: Scanner type
    enum:
    - http
    - spa
    type: string
    x-enum-comments:
      ScannerHTTP: standard HTTP fetcher
      ScannerSPA: chromedp for SPA/protected sites
    x-enum-descriptions:
    - standard HTTP fetcher
    - chromedp for SPA/protected sites
    x-enum-varnames:
    - ScannerHTTP
    - ScannerSPA
  github_com_video-analitics_backend_pkg_status.Site:
    description: Site status
    enum:
    - pending
    - active
    - down
    - dead
    - frozen
    - moved
    type: string
    x-enum-comments:
      SiteActive: ready for scanning
      SiteDead: permanently unavailable (2+ failures)
      SiteDown: temporarily unavailable (1 failure)
      SiteFrozen: blocked (403/captcha), requires SPA scanner
      SiteMoved: domain redirected to another domain
      SitePending: awaiting detection
    x-enum-descriptions:
    - awaiting detection
    - ready for scanning
    - temporarily unavailable (1 failure)
    - permanently unavailable (2+ failures)
    - blocked (403/captcha), requires SPA scanner
    - domain redirected to another domain
    x-enum-varnames:
    - SitePending
    - SiteActive
    - SiteDown
    - SiteDead
    - SiteFrozen
    - SiteMoved
  github_com_video-analitics_backend_pkg_status.SitemapStatus:
    description: Sitemap detection status
    enum:
    - none
    - valid
    - invalid
    - empty
    type: string
    x-enum-comments:
      SitemapEmpty: sitemap works but has no URLs
      SitemapInvalid: sitemap declared but unavailable (404, parse error)
      SitemapNone: sitemap not found
      SitemapValid: sitemap works and contains URLs
    x-enum-descriptions:
    - sitemap not found
    - sitemap works and contains URLs
    - sitemap declared but unavailable (404, parse error)
    - sitemap works but has no URLs
    x-enum-varnames:
    - SitemapNone
    - SitemapValid
    - SitemapInvalid
    - SitemapEmpty
  github_com_video-analitics_backend_pkg_status.Stage:
    description: Task stage
    enum:
    - sitemap
    - page
    - done
    type: string
    x-enum-comments:
      StageDone: all stages completed
      StagePage: parsing pages
      StageSitemap: collecting URLs from sitemap
    x-enum-descriptions:
    - collecting URLs from sitemap
    - parsing pages
    - all stages completed
    x-enum-varnames:
    - StageSitemap
    - StagePage
    - StageDone
  github_com_video-analitics_backend_pkg_status.Task:
    description: Task status
    enum:
    - pending
    - processing
    - completed
    - failed
    - cancelled
    type: string
    x-enum-comments:
      TaskCancelled: cancelled by user
      TaskCompleted: finished successfully
      TaskFailed: finished with error
      TaskPending: waiting in queue
      TaskProcessing: being processed by worker
    x-enum-descriptions:
    - waiting in queue
    - being processed by worker
    - finished successfully
    - finished with error
    - cancelled by user
    x-enum-varnames:
    - TaskPending
    - TaskProcessing
    - TaskCompleted
    - TaskFailed
    - TaskCancelled
  github_com_video-analitics_backend_pkg_status.URL:
    description: URL indexing status
    enum:
    - pending
    - indexed
    - error
    - skipped
    type: string
    x-enum-comments:
      URLError: failed after max retries
      URLIndexed: successfully indexed
      URLPending: waiting to be indexed
      URLSkipped: skipped (e.g., XML sitemap reference)
    x-enum-descriptions:
    - waiting to be indexed
    - successfully indexed
    - failed after max retries
    - skipped (e.g., XML sitemap reference)
    x-enum-varnames:
    - URLPending
    - URLIndexed
    - URLError
    - URLSkipped
  github_com_video-analitics_indexer_internal_repo.PageStats:
    properties:
      total:
        type: integer
      with_imdb_id:
        type: integer
      with_kpid:
        type: integer
      with_player:
        type: integer
    type: object
  github_com_video-analitics_indexer_internal_repo.ScanTask:
    properties:
      created_at:
        type: string
      domain:
        type: string
      finished_at:
        type: string
      id:
        type: string
      page_result:
        $ref: '#/definitions/github_com_video-analitics_indexer_internal_repo.StageResult'
      site_id:
        type: string
      sitemap_result:
        $ref: '#/definitions/github_com_video-analitics_indexer_internal_repo.StageResult'
      stage:
        $ref: '#/definitions/github_com_video-analitics_backend_pkg_status.Stage'
      status:
        $ref: '#/definitions/github_com_video-analitics_backend_pkg_status.Task'
    type: object
  github_com_video-analitics_indexer_internal_repo.Site:
    properties:
      captcha_type:
        type: string
      cms:
        type: string
      cookies_updated_at:
        type: string
      crawl_strategy:
        $ref: '#/definitions/github_com_video-analitics_backend_pkg_status.CrawlStrategy'
      created_at:
        type: string
      domain:
        type: string
      failure_count:
        type: integer
      freeze_reason:
        type: string
      has_sitemap:
        type: boolean
      id:
        type: string
      last_scan_at:
        type: string
      moved_at:
        type: string
      moved_to_domain:
        type: string
      next_scan_at:
        type: string
      original_domain:
        type: string
      owner_id:
        type: string
      scan_interval_h:
        type: integer
      scanner_type:
        $ref: '#/definitions/github_com_video-analitics_backend_pkg_status.ScannerType'
      sitemap_status:
        $ref: '#/definitions/github_com_video-analitics_backend_pkg_status.SitemapStatus'
      sitemap_urls:
        items:
          type: string
        type: array
      sitemaps:
        items:
          $ref: '#/definitions/github_com_video-analitics_indexer_internal_repo.SitemapInfo'
        type: array
      status:
        $ref: '#/definitions/github_com_video-analitics_backend_pkg_status.Site'
      total_urls_count:
        type: integer
    type: object
  github_com_video-analitics_indexer_internal_repo.SitemapInfo:
    properties:
      error_count:
        type: integer
      last_error:
        type: string
      last_parsed_at:
        type: string
      last_urls_found:
        type: integer
      url:
        type: string
      urls_count:
        type: integer
    type: object
  github_com_video-analitics_indexer_internal_repo.SitemapURL:
    properties:
      changefreq:
        type: string
      depth:
        description: 'Глубина: 0 = из sitemap/главная, 1-3 = найдены при парсинге
          страниц'
        type: integer
      discovered_at:
        type: string
      error:
        type: string
      id:
        type: string
      indexed_at:
        type: string
      is_xml:
        type: boolean
      last_attempt_at:
        type: string
      lastmod:
        type: string
      locked_until:
        type: string
      priority:
        type: number
      retry_count:
        type: integer
      site_id:
        type: string
      sitemap_source:
        type: string
      status:
        $ref: '#/definitions/github_com_video-analitics_backend_pkg_status.URL'
      url:
        type: string
    type: object
  github_com_video-analitics_indexer_internal_repo.SitemapURLStats:
    properties:
      error:
        type: integer
      indexed:
        type: integer
      pending:
        type: integer
      skipped:
        type: integer
      total:
        type: integer
    type: object
  github_com_video-analitics_indexer_internal_repo.StageResult:
    properties:
      error:
        type: string
      failed:
        type: integer
      finished_at:
        type: string
      started_at:
        type: string
      status:
        $ref: '#/definitions/github_com_video-analitics_backend_pkg_status.Task'
      success:
        type: integer
      total:
        type: integer
    type: object
  github_com_video-analitics_indexer_internal_repo.User:
    properties:
      created_at:
        type: string
      id:
        type: string
      is_active:
        type: boolean
      login:
        type: string
      role:
        type: string
    type: object
  indexer_internal_handler.ActiveTaskProgress:
    properties:
      failed:
        type: integer
      success:
        type: integer
      total:
        type: integer
    type: object
  indexer_internal_handler.AllURLsResponse:
    properties:
      count:
        type: integer
      urls:
        items:
          type: string
        type: array
    type: object
  indexer_internal_handler.CancelTasksRequest:
    properties:
      task_ids:
        items:
          type: string
        type: array
    type: object
  indexer_internal_handler.CancelTasksResponse:
    properties:
      cancelled_count:
        type: integer
    type: object
  indexer_internal_handler.CheckViolationsRequest:
    properties:
      content_ids:
        items:
          type: string
        type: array
    type: object
  indexer_internal_handler.CheckViolationsResponse:
    properties:
      checked_count:
        type: integer
    type: object
  indexer_internal_handler.ContentWithStats:
    properties:
      created_at:
        type: string
      id:
        type: string
      imdb_id:
        type: string
      kinopoisk_id:
        type: string
      mal_id:
        type: string
      mydramalist_id:
        type: string
      original_title:
        type: string
      owner_id:
        type: string
      shikimori_id:
        type: string
      sites_count:
        type: integer
      title:
        type: string
      violations_count:
        type: integer
      year:
        type: integer
    type: object
  indexer_internal_handler.CreateContentBatchRequest:
    properties:
      items:
        items:
          $ref: '#/definitions/indexer_internal_handler.CreateContentRequest'
        type: array
    type: object
  indexer_internal_handler.CreateContentBatchResponse:
    properties:
      content_ids:
        items:
          type: string
        type: array
      created:
        type: integer
      failed:
        type: integer
    type: object
  indexer_internal_handler.CreateContentRequest:
    properties:
      imdb_id:
        type: string
      kinopoisk_id:
        type: string
      mal_id:
        type: string
      mydramalist_id:
        type: string
      original_title:
        type: string
      shikimori_id:
        type: string
      title:
        type: string
      year:
        type: integer
    type: object
  indexer_internal_handler.CreateSiteRequest:
    properties:
      cms:
        type: string
      domain:
        type: string
      has_sitemap:
        type: boolean
      scan_interval_h:
        type: integer
      sitemap_urls:
        items:
          type: string
        type: array
    type: object
  indexer_internal_handler.CreateSitesBatchRequest:
    properties:
      sites:
        items:
          $ref: '#/definitions/indexer_internal_handler.CreateSiteRequest'
        type: array
    type: object
  indexer_internal_handler.CreateSitesBatchResponse:
    properties:
      created:
        type: integer
      failed:
        type: integer
      site_ids:
        items:
          type: string
        type: array
    type: object
  indexer_internal_handler.CreateUserRequest:
    properties:
      login:
        type: string
      password:
        type: string
      role:
        type: string
    type: object
  indexer_internal_handler.DeleteContentRequest:
    properties:
      content_ids:
        items:
          type: string
        type: array
    type: object
  indexer_internal_handler.DeleteContentResponse:
    properties:
      deleted_count:
        type: integer
    type: object
  indexer_internal_handler.DeleteSitesRequest:
    properties:
      site_ids:
        items:
          type: string
        type: array
    type: object
  indexer_internal_handler.DeleteSitesResponse:
    properties:
      deleted_count:
        type: integer
      pages_deleted:
        type: integer
      tasks_deleted:
        type: integer
    type: object
  indexer_internal_handler.ErrorResponse:
    properties:
      error:
        type: string
    type: object
  indexer_internal_handler.LastScanResult:
    properties:
      status:
        type: string
      success:
        type: integer
      total:
        type: integer
    type: object
  indexer_internal_handler.ListContentResponse:
    properties:
      items:
        items:
          $ref: '#/definitions/indexer_internal_handler.ContentWithStats'
        type: array
      total:
        type: integer
    type: object
  indexer_internal_handler.ListPagesResponse:
    properties:
      items:
        items:
          $ref: '#/definitions/indexer_internal_handler.PageResponse'
        type: array
      total:
        type: integer
    type: object
  indexer_internal_handler.ListSiteViolationsResponse:
    properties:
      items:
        items:
          $ref: '#/definitions/indexer_internal_handler.SiteViolationResponse'
        type: array
      total:
        type: integer
    type: object
  indexer_internal_handler.ListSitesResponse:
    properties:
      items:
        items:
          $ref: '#/definitions/indexer_internal_handler.SiteWithStats'
        type: array
      total:
        type: integer
    type: object
  indexer_internal_handler.ListTasksResponse:
    properties:
      items:
        items:
          $ref: '#/definitions/github_com_video-analitics_indexer_internal_repo.ScanTask'
        type: array
      total:
        type: integer
    type: object
  indexer_internal_handler.ListViolationsResponse:
    properties:
      items:
        items:
          $ref: '#/definitions/indexer_internal_handler.ViolationResponse'
        type: array
      total:
        type: integer
    type: object
  indexer_internal_handler.LoginRequest:
    properties:
      login:
        type: string
      password:
        type: string
    type: object
  indexer_internal_handler.PageExternalIDs:
    properties:
      imdb_id:
        type: string
      kinopoisk_id:
        type: string
      mal_id:
        type: string
      mydramalist_id:
        type: string
      shikimori_id:
        type: string
      tmdb_id:
        type: string
    type: object
  indexer_internal_handler.PageResponse:
    properties:
      description:
        type: string
      external_ids:
        $ref: '#/definitions/indexer_internal_handler.PageExternalIDs'
      http_status:
        type: integer
      id:
        type: string
      indexed_at:
        type: string
      player_url:
        type: string
      site_id:
        type: string
      title:
        type: string
      url:
        type: string
      year:
        type: integer
    type: object
  indexer_internal_handler.PendingURLWithDepth:
    properties:
      depth:
        type: integer
      url:
        type: string
    type: object
  indexer_internal_handler.PendingURLsResponse:
    properties:
      all_indexed:
        type: boolean
      in_retry:
        type: boolean
      indexed_urls:
        type: integer
      total_urls:
        type: integer
      urls:
        items:
          $ref: '#/definitions/indexer_internal_handler.PendingURLWithDepth'
        type: array
    type: object
  indexer_internal_handler.RefreshRequest:
    properties:
      refresh_token:
        type: string
    type: object
  indexer_internal_handler.ScanRequest:
    properties:
      site_ids:
        items:
          type: string
        type: array
    type: object
  indexer_internal_handler.ScanResponse:
    properties:
      message:
        type: string
      site_count:
        type: integer
      task_ids:
        items:
          type: string
        type: array
    type: object
  indexer_internal_handler.ScanStageResponse:
    properties:
      message:
        type: string
      task_id:
        type: string
    type: object
  indexer_internal_handler.SiteViolationResponse:
    properties:
      content_id:
        type: string
      found_at:
        type: string
      match_type:
        type: string
      page_id:
        type: string
      title:
        type: string
      url:
        type: string
    type: object
  indexer_internal_handler.SiteWithStats:
    properties:
      active_stage:
        type: string
      active_task_progress:
        $ref: '#/definitions/indexer_internal_handler.ActiveTaskProgress'
      captcha_type:
        type: string
      cms:
        type: string
      cookies_updated_at:
        type: string
      crawl_strategy:
        $ref: '#/definitions/github_com_video-analitics_backend_pkg_status.CrawlStrategy'
      created_at:
        type: string
      domain:
        type: string
      failure_count:
        type: integer
      freeze_reason:
        type: string
      has_sitemap:
        type: boolean
      id:
        type: string
      last_scan:
        $ref: '#/definitions/indexer_internal_handler.LastScanResult'
      last_scan_at:
        type: string
      moved_at:
        type: string
      moved_to_domain:
        type: string
      next_scan_at:
        type: string
      original_domain:
        type: string
      owner_id:
        type: string
      pending_urls_count:
        type: integer
      scan_interval_h:
        type: integer
      scanner_type:
        $ref: '#/definitions/github_com_video-analitics_backend_pkg_status.ScannerType'
      sitemap_status:
        $ref: '#/definitions/github_com_video-analitics_backend_pkg_status.SitemapStatus'
      sitemap_urls:
        items:
          type: string
        type: array
      sitemaps:
        items:
          $ref: '#/definitions/github_com_video-analitics_indexer_internal_repo.SitemapInfo'
        type: array
      status:
        $ref: '#/definitions/github_com_video-analitics_backend_pkg_status.Site'
      total_urls_count:
        type: integer
      violations_count:
        type: integer
    type: object
  indexer_internal_handler.SitemapURLsResponse:
    properties:
      limit:
        type: integer
      page:
        type: integer
      total:
        type: integer
      urls:
        items:
          $ref: '#/definitions/github_com_video-analitics_indexer_internal_repo.SitemapURL'
        type: array
    type: object
  indexer_internal_handler.SuccessResponse:
    properties:
      message:
        type: string
    type: object
  indexer_internal_handler.TokenResponse:
    properties:
      access_token:
        type: string
      expires_in:
        type: integer
      refresh_token:
        type: string
    type: object
  indexer_internal_handler.UnfreezeRequest:
    properties:
      scanner_type:
        description: '"http" или "spa"'
        type: string
    type: object
  indexer_internal_handler.UpdateUserRequest:
    properties:
      is_active:
        type: boolean
      login:
        type: string
      password:
        type: string
      role:
        type: string
    type: object
  indexer_internal_handler.UsersListResponse:
    properties:
      items:
        items:
          $ref: '#/definitions/github_com_video-analitics_indexer_internal_repo.User'
        type: array
      total:
        type: integer
    type: object
  indexer_internal_handler.ViolationResponse:
    properties:
      domain:
        type: string
      found_at:
        type: string
      match_type:
        type: string
      page_id:
        type: string
      site_id:
        type: string
      title:
        type: string
      url:
        type: string
    type: object
info:
  contact: {}
paths:
  /api/auth/login:
    post:
      consumes:
      - application/json
      description: Authenticate user and get tokens
      parameters:
      - description: Credentials
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/indexer_internal_handler.LoginRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.TokenResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Login
      tags:
      - auth
  /api/auth/logout:
    post:
      description: Invalidate refresh token
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.SuccessResponse'
      security:
      - BearerAuth: []
      summary: Logout
      tags:
      - auth
  /api/auth/me:
    get:
      description: Get authenticated user profile
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/github_com_video-analitics_indexer_internal_repo.User'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Get current user
      tags:
      - auth
  /api/auth/refresh:
    post:
      consumes:
      - application/json
      description: Get new access token using refresh token
      parameters:
      - description: Refresh token
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/indexer_internal_handler.RefreshRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.TokenResponse'
        "401":
          description: Unauthorized
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Refresh access token
      tags:
      - auth
  /api/content:
    get:
      description: Get list of tracked content with violation stats
      parameters:
      - description: Search by title
        in: query
        name: title
        type: string
      - description: Filter by Kinopoisk ID
        in: query
        name: kinopoisk_id
        type: string
      - description: Filter by IMDB ID
        in: query
        name: imdb_id
        type: string
      - description: Filter by MAL ID
        in: query
        name: mal_id
        type: string
      - description: Filter by Shikimori ID
        in: query
        name: shikimori_id
        type: string
      - description: Filter by MyDramaList ID
        in: query
        name: mydramalist_id
        type: string
      - description: Filter by violations presence (true/false)
        in: query
        name: has_violations
        type: string
      - default: violations_count
        description: Sort by field
        enum:
        - violations_count
        - created_at
        in: query
        name: sort_by
        type: string
      - default: desc
        description: Sort order
        enum:
        - asc
        - desc
        in: query
        name: sort_order
        type: string
      - default: 20
        description: Limit
        in: query
        name: limit
        type: integer
      - default: 0
        description: Offset
        in: query
        name: offset
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.ListContentResponse'
      summary: List content
      tags:
      - content
    post:
      consumes:
      - application/json
      description: Add content to track for violations
      parameters:
      - description: Content data
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/indexer_internal_handler.CreateContentRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/indexer_internal_handler.ContentWithStats'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Create content
      tags:
      - content
  /api/content/{id}:
    delete:
      description: Remove content from tracking
      parameters:
      - description: Content ID
        in: path
        name: id
        required: true
        type: string
      responses:
        "204":
          description: No Content
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Delete content
      tags:
      - content
    get:
      description: Get content details with violation stats
      parameters:
      - description: Content ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.ContentWithStats'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Get content by ID
      tags:
      - content
  /api/content/{id}/violations:
    get:
      description: Get list of pages where content was found
      parameters:
      - description: Content ID
        in: path
        name: id
        required: true
        type: string
      - default: 20
        description: Limit
        in: query
        name: limit
        type: integer
      - default: 0
        description: Offset
        in: query
        name: offset
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.ListViolationsResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Get violations for content
      tags:
      - content
  /api/content/{id}/violations/export:
    get:
      description: Export all violations for content to CSV file
      parameters:
      - description: Content ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - text/csv
      responses:
        "200":
          description: OK
          schema:
            type: file
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Export violations to CSV
      tags:
      - content
  /api/content/batch:
    post:
      consumes:
      - application/json
      description: Add multiple content items to track for violations in a single
        batch request
      parameters:
      - description: Content items data
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/indexer_internal_handler.CreateContentBatchRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/indexer_internal_handler.CreateContentBatchResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Create multiple content items
      tags:
      - content
  /api/content/check-violations:
    post:
      consumes:
      - application/json
      description: Refresh violation stats for selected content items
      parameters:
      - description: Content IDs to check
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/indexer_internal_handler.CheckViolationsRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.CheckViolationsResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Check violations for content
      tags:
      - content
  /api/content/delete:
    post:
      consumes:
      - application/json
      description: Remove multiple content items from tracking
      parameters:
      - description: Content IDs to delete
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/indexer_internal_handler.DeleteContentRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.DeleteContentResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Delete multiple content items
      tags:
      - content
  /api/pages:
    get:
      description: Get list of indexed pages with filtering
      parameters:
      - description: Filter by site ID
        in: query
        name: site_id
        type: string
      - description: Filter by Kinopoisk ID
        in: query
        name: kpid
        type: string
      - description: Filter by IMDb ID
        in: query
        name: imdb_id
        type: string
      - description: Search by title
        in: query
        name: title
        type: string
      - description: Filter by year
        in: query
        name: year
        type: integer
      - description: Filter by player presence
        in: query
        name: has_player
        type: boolean
      - description: Filter by violations presence (requires site_id)
        in: query
        name: has_violations
        type: boolean
      - default: indexed_at
        description: Sort by field
        enum:
        - indexed_at
        - year
        in: query
        name: sort_by
        type: string
      - default: desc
        description: Sort order
        enum:
        - asc
        - desc
        in: query
        name: sort_order
        type: string
      - default: 20
        description: Limit
        in: query
        name: limit
        type: integer
      - default: 0
        description: Offset
        in: query
        name: offset
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.ListPagesResponse'
      summary: List indexed pages
      tags:
      - pages
  /api/pages/stats:
    get:
      description: Get statistics about indexed pages
      parameters:
      - description: Filter by site ID
        in: query
        name: site_id
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/github_com_video-analitics_indexer_internal_repo.PageStats'
      summary: Get page statistics
      tags:
      - pages
  /api/scan-tasks:
    get:
      description: Get list of recent scan tasks
      parameters:
      - description: Filter by site ID
        in: query
        name: site_id
        type: string
      - description: Filter by domain (partial match)
        in: query
        name: domain
        type: string
      - description: Filter by status (pending, processing, completed, failed, cancelled)
        in: query
        name: status
        type: string
      - default: 20
        description: Limit
        in: query
        name: limit
        type: integer
      - default: 0
        description: Offset
        in: query
        name: offset
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.ListTasksResponse'
      security:
      - BearerAuth: []
      summary: List recent scan tasks
      tags:
      - tasks
  /api/scan-tasks/{id}:
    get:
      description: Get scan task details and status
      parameters:
      - description: Task ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/github_com_video-analitics_indexer_internal_repo.ScanTask'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Get scan task by ID
      tags:
      - tasks
  /api/scan-tasks/cancel:
    post:
      consumes:
      - application/json
      description: Cancel pending or processing scan tasks
      parameters:
      - description: Task IDs to cancel
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/indexer_internal_handler.CancelTasksRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.CancelTasksResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Cancel scan tasks
      tags:
      - tasks
  /api/sites:
    get:
      description: Get list of monitored sites with pagination
      parameters:
      - description: Filter by status (active, down, dead)
        in: query
        name: status
        type: string
      - description: Filter by last scan date (today, week, month)
        in: query
        name: scanned_since
        type: string
      - description: Filter by violations (true, false)
        in: query
        name: has_violations
        type: string
      - default: 20
        description: Limit
        in: query
        name: limit
        type: integer
      - default: 0
        description: Offset
        in: query
        name: offset
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.ListSitesResponse'
      summary: List all sites
      tags:
      - sites
    post:
      consumes:
      - application/json
      description: Add a new site to monitor
      parameters:
      - description: Site data
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/indexer_internal_handler.CreateSiteRequest'
      produces:
      - application/json
      responses:
        "200":
          description: Site already exists, user linked
          schema:
            $ref: '#/definitions/github_com_video-analitics_indexer_internal_repo.Site'
        "201":
          description: Created
          schema:
            $ref: '#/definitions/github_com_video-analitics_indexer_internal_repo.Site'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "409":
          description: Site already in user's list
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Create a new site
      tags:
      - sites
  /api/sites/{id}:
    delete:
      consumes:
      - application/json
      description: Delete a site by ID along with all related pages and tasks
      parameters:
      - description: Site ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties: true
            type: object
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Delete site
      tags:
      - sites
    get:
      description: Get site details
      parameters:
      - description: Site ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.SiteWithStats'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Get site by ID
      tags:
      - sites
  /api/sites/{id}/all-urls:
    get:
      consumes:
      - application/json
      description: Returns all URL strings for a site (for crawler deduplication)
      parameters:
      - description: Site ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.AllURLsResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Get all discovered URLs for a site
      tags:
      - sites
  /api/sites/{id}/analyze:
    post:
      description: Re-run detection for a frozen or pending site
      parameters:
      - description: Site ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            additionalProperties:
              type: string
            type: object
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Re-analyze a site
      tags:
      - sites
  /api/sites/{id}/pending-urls:
    get:
      consumes:
      - application/json
      description: Get URLs that need to be parsed (status=pending, respects retry
        logic)
      parameters:
      - description: Site ID
        in: path
        name: id
        required: true
        type: string
      - default: 50
        description: Max URLs to return
        in: query
        name: limit
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.PendingURLsResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Get pending URLs for crawling
      tags:
      - sites
  /api/sites/{id}/scan-pages:
    post:
      description: Start page crawl for pending URLs without re-scanning sitemap
      parameters:
      - description: Site ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.ScanStageResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Scan pages only
      tags:
      - sites
  /api/sites/{id}/scan-sitemap:
    post:
      description: Start sitemap crawl to collect URLs without parsing pages
      parameters:
      - description: Site ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.ScanStageResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Scan sitemap only
      tags:
      - sites
  /api/sites/{id}/sitemap-urls:
    get:
      consumes:
      - application/json
      description: Get paginated list of URLs from sitemap
      parameters:
      - description: Site ID
        in: path
        name: id
        required: true
        type: string
      - description: Filter by status (pending, indexed, error, skipped)
        in: query
        name: status
        type: string
      - default: 50
        description: Items per page
        in: query
        name: limit
        type: integer
      - default: 1
        description: Page number
        in: query
        name: page
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.SitemapURLsResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: List sitemap URLs for a site
      tags:
      - sites
  /api/sites/{id}/sitemap-urls/stats:
    get:
      consumes:
      - application/json
      description: Get count of URLs by status
      parameters:
      - description: Site ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/github_com_video-analitics_indexer_internal_repo.SitemapURLStats'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Get sitemap URLs statistics
      tags:
      - sites
  /api/sites/{id}/unfreeze:
    post:
      consumes:
      - application/json
      description: Unfreeze a site and optionally change scanner type
      parameters:
      - description: Site ID
        in: path
        name: id
        required: true
        type: string
      - description: Scanner type
        in: body
        name: request
        schema:
          $ref: '#/definitions/indexer_internal_handler.UnfreezeRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/github_com_video-analitics_indexer_internal_repo.Site'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Unfreeze a frozen site
      tags:
      - sites
  /api/sites/{id}/violations:
    get:
      description: Get list of content violations found on this site
      parameters:
      - description: Site ID
        in: path
        name: id
        required: true
        type: string
      - default: 20
        description: Limit
        in: query
        name: limit
        type: integer
      - default: 0
        description: Offset
        in: query
        name: offset
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.ListSiteViolationsResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Get violations for site
      tags:
      - sites
  /api/sites/batch:
    post:
      consumes:
      - application/json
      description: Add multiple sites to monitor in a single batch request
      parameters:
      - description: Sites data
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/indexer_internal_handler.CreateSitesBatchRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/indexer_internal_handler.CreateSitesBatchResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Create multiple sites
      tags:
      - sites
  /api/sites/delete:
    post:
      consumes:
      - application/json
      description: Delete multiple sites by ID along with all related pages and tasks
      parameters:
      - description: Site IDs to delete
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/indexer_internal_handler.DeleteSitesRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.DeleteSitesResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Delete multiple sites
      tags:
      - sites
  /api/sites/scan:
    post:
      consumes:
      - application/json
      description: Queues sites for crawling and indexing
      parameters:
      - description: Site IDs to scan
        in: body
        name: request
        required: true
        schema:
          $ref: '#/definitions/indexer_internal_handler.ScanRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.ScanResponse'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      summary: Start scanning sites
      tags:
      - scan
  /api/users:
    get:
      description: Get list of all users with pagination
      parameters:
      - description: Filter by role (admin, user)
        in: query
        name: role
        type: string
      - description: Filter by active status
        in: query
        name: is_active
        type: boolean
      - default: 20
        description: Limit
        in: query
        name: limit
        type: integer
      - default: 0
        description: Offset
        in: query
        name: offset
        type: integer
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.UsersListResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: List users (admin only)
      tags:
      - users
    post:
      consumes:
      - application/json
      description: Create a new user
      parameters:
      - description: User data
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/indexer_internal_handler.CreateUserRequest'
      produces:
      - application/json
      responses:
        "201":
          description: Created
          schema:
            $ref: '#/definitions/github_com_video-analitics_indexer_internal_repo.User'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "409":
          description: Conflict
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Create user (admin only)
      tags:
      - users
  /api/users/{id}:
    delete:
      description: Deactivate a user (soft delete)
      parameters:
      - description: User ID
        in: path
        name: id
        required: true
        type: string
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/indexer_internal_handler.SuccessResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Soft delete user (admin only)
      tags:
      - users
    put:
      consumes:
      - application/json
      description: Update user details
      parameters:
      - description: User ID
        in: path
        name: id
        required: true
        type: string
      - description: User data
        in: body
        name: body
        required: true
        schema:
          $ref: '#/definitions/indexer_internal_handler.UpdateUserRequest'
      produces:
      - application/json
      responses:
        "200":
          description: OK
          schema:
            $ref: '#/definitions/github_com_video-analitics_indexer_internal_repo.User'
        "400":
          description: Bad Request
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "403":
          description: Forbidden
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
        "404":
          description: Not Found
          schema:
            $ref: '#/definitions/indexer_internal_handler.ErrorResponse'
      security:
      - BearerAuth: []
      summary: Update user (admin only)
      tags:
      - users
swagger: "2.0"
